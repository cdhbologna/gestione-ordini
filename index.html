<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestione Ordini Hotel</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f2f2f2; }
h1 { text-align:center; margin:10px 0; }
.header { padding:10px; text-align:center; background:white; }
.container { display:flex; flex-direction:column; height:calc(100vh - 60px); }
.riga { display:flex; flex:1; flex-direction:column; }
.items, .tavoli-box-container { flex:1; padding:10px; overflow-y:auto; -webkit-overflow-scrolling: touch; }
.items { background:white; }
.tavoli-box-container { background:#fafafa; border-top:3px solid #ddd; }

.categoria-box { padding:10px; margin-bottom:10px; border-radius:8px; color:white; cursor:pointer; font-weight:bold; transition:0.3s; }
.categoria-box.active { border:2px solid #3498db; background-color: #eaf3ff; }

.main {background:#e74c3c;} 
.light {background:#27ae60;} 
.croccantella {background:#c0392b;} 
.bevande {background:#2980b9;} 
.altro {background:#8e44ad;}

.prodotto { padding:15px; margin:5px 0; border:none; border-radius:10px; width:100%; cursor:pointer; background:#3498db; color:white; }
.prodotto:active { transform:scale(0.98); }

.prodotti-dropdown { display:none; padding-left:10px; overflow-y:auto; max-height:250px; }
#altroInput { display:flex; margin-bottom:10px; }
#altroInput input, #altroInput button { padding:8px; margin:5px; flex:1; }

.tavolo-box { padding:8px; margin-bottom:5px; border:1px solid #ccc; border-radius:5px; background:white; display:flex; flex-direction:column; position:relative; }
.tavolo-box button { padding:3px 6px; font-size:12px; }

button.azione { background:green; color:white; margin-top:10px; padding:10px; width:100%; border:none; border-radius:8px; cursor:pointer; }

ul { padding-left:20px; }
li { margin-bottom:8px; font-size:16px; }

.elimina-tutti { background:red; color:white; padding:10px; border:none; border-radius:8px; margin-top:10px; cursor:pointer; width:100%; }
</style>
</head>
<body>

<h1>Gestione Ordini Hotel</h1>

<div class="header">
<strong>Numero Tavolo:</strong>
<input type="number" id="numeroTavolo" style="font-size:16px; padding:5px; width:80px;">
<button onclick="selezionaTavolo()">Apri Tavolo</button>
</div>

<div class="container riga">

  <!-- Riquadro alto: Items -->
  <div class="items" id="itemsContainer">

    <!-- Light and Tasty -->
    <div class="categoria-box light" onclick="toggleProdotti('lightProdotti', this)">Light and Tasty</div>
    <div id="lightProdotti" class="prodotti-dropdown">
      <button class="prodotto" onclick="aggiungiProdotto('Bufala',11)">Bufala â‚¬11</button>
      <button class="prodotto" onclick="aggiungiProdotto('Salmone in rosa',14)">Salmone in rosa â‚¬14</button>
      <button class="prodotto" onclick="aggiungiProdotto('Salmon salad',16)">Salmon salad â‚¬16</button>
      <button class="prodotto" onclick="aggiungiProdotto('Insalatone dello chef',15)">Insalatone dello chef â‚¬15</button>
      <button class="prodotto" onclick="aggiungiProdotto('Caesar salad',15)">Caesar salad â‚¬15</button>
      <button class="prodotto" onclick="aggiungiProdotto('Tagliere delle eccellenze',17)">Tagliere delle eccellenze â‚¬17</button>
    </div>

    <!-- MAIN -->
    <div class="categoria-box main" onclick="toggleProdotti('mainProdotti', this)">MAIN</div>
    <div id="mainProdotti" class="prodotti-dropdown">
      <button class="prodotto" onclick="aggiungiProdotto('Tortelli',12)">Tortelli â‚¬12</button>
      <button class="prodotto" onclick="aggiungiProdotto('Lasagna',12)">Lasagna â‚¬12</button>
      <button class="prodotto" onclick="aggiungiProdotto('Tagliatella al ragÃ¹',11)">Tagliatella al ragÃ¹ â‚¬11</button>
      <button class="prodotto" onclick="aggiungiProdotto('Tagliatelle al pomodoro',10)">Tagliatelle al pomodoro â‚¬10</button>
      <button class="prodotto" onclick="aggiungiProdotto('Crema carote e zenzero',9.5)">Crema carote e zenzero â‚¬9.50</button>
      <button class="prodotto" onclick="aggiungiProdotto('Club Sandwich',15)">Club Sandwich â‚¬15</button>
      <button class="prodotto" onclick="aggiungiProdotto('Ossobuco di Manzo',19)">Ossobuco di Manzo â‚¬19</button>
      <button class="prodotto" onclick="aggiungiProdotto('Filetto di Salmone',22)">Filetto di Salmone â‚¬22</button>
      <button class="prodotto" onclick="aggiungiProdotto('Petto di pollo',15)">Petto di pollo â‚¬15</button>
      <button class="prodotto" onclick="aggiungiProdotto('Ribs di Maiale',17)">Ribs di Maiale â‚¬17</button>
      <button class="prodotto" onclick="aggiungiProdotto('Tacchino tonnato',15)">Tacchino tonnato â‚¬15</button>
    </div>

    <!-- CROCCANTELLA -->
    <div class="categoria-box croccantella" onclick="toggleProdotti('croccantellaProdotti', this)">CROCCANTELLA</div>
    <div id="croccantellaProdotti" class="prodotti-dropdown">
      <button class="prodotto" onclick="aggiungiProdotto('Margherita',10)">Margherita â‚¬10</button>
      <button class="prodotto" onclick="aggiungiProdotto('Parma',14)">Parma â‚¬14</button>
      <button class="prodotto" onclick="aggiungiProdotto('Bolognese',13)">Bolognese â‚¬13</button>
    </div>

    <!-- BEVANDE -->
    <div class="categoria-box bevande" onclick="toggleProdotti('bevandeProdotti', this)">BEVANDE</div>
    <div id="bevandeProdotti" class="prodotti-dropdown">
      <button class="prodotto" onclick="aggiungiProdotto('Acqua (0.5)',1.5)">Acqua (0.5) â‚¬1.50</button>
      <button class="prodotto" onclick="aggiungiProdotto('Acqua (0.75)',3)">Acqua (0.75) â‚¬3.00</button>
      <button class="prodotto" onclick="aggiungiProdotto('Vino della casa calice',5)">Vino della casa calice â‚¬5.00</button>
      <button class="prodotto" onclick="aggiungiProdotto('Soft drink',4)">Soft drink â‚¬4.00</button>
    </div>

    <!-- ALTRO -->
    <div class="categoria-box altro" onclick="toggleProdotti('altroProdotti', this)">ALTRO</div>
    <div id="altroProdotti" class="prodotti-dropdown">
      <div id="altroInput">
        <input type="text" id="altroNome" placeholder="Nome Prodotto">
        <input type="number" id="altroPrezzo" placeholder="Prezzo">
        <button onclick="aggiungiProdottoAltro()">Aggiungi</button>
      </div>
    </div>

  </div>

  <!-- Riquadro basso: Tavoli e ordini -->
  <div class="tavoli-box-container" id="tavoliContainer">
    <h3>Lista Tavoli</h3>
  </div>

  <!-- Chiusura Giornaliera -->
  <div style="padding:10px;">
    <button class="azione" onclick="chiusuraGiornaliera()">CHIUSURA GIORNALIERA ðŸŽ†</button>
    <button class="elimina-tutti" onclick="eliminaTuttiTavoli()">ELIMINA TUTTI I TAVOLI ðŸ˜¢</button>
  </div>

</div>

<script>
let tavoli = {};
let tavoloSelezionato = null;
let statoTavoli = {}; // tiene traccia se la lista ordini del tavolo Ã¨ aperta

// ---------- Toggle menu dropdown ----------
function toggleProdotti(id, element) {
  const prodotti = document.getElementById(id);
  const allCategorie = document.querySelectorAll('.categoria-box');
  for (let cat of allCategorie) {
    if (cat !== element) {
      cat.classList.remove('active');
      const otherProdotti = document.getElementById(cat.textContent.trim() + 'Prodotti');
      if (otherProdotti) otherProdotti.style.display = 'none';
    }
  }
  if (prodotti.style.display === 'none' || prodotti.style.display === '') {
    element.classList.add('active');
    prodotti.style.display = 'block';
  } else {
    element.classList.remove('active');
    prodotti.style.display = 'none';
  }
}

// ---------- Tavolo ----------
function selezionaTavolo() {
  const num = document.getElementById('numeroTavolo').value;
  if (!num) return alert('Inserisci numero tavolo');
  if (!tavoli[num]) tavoli[num] = { ordine: {} };
  tavoloSelezionato = num;
  renderTavoli();
}

function aggiungiProdotto(nome, prezzo) {
  if (!tavoloSelezionato) return alert('Seleziona un tavolo prima');
  let ord = tavoli[tavoloSelezionato].ordine;
  if (ord[nome]) ord[nome].q++;
  else ord[nome] = { p: prezzo, q: 1 };
  renderTavoli();
}

function aggiungiProdottoAltro() {
  const nome = document.getElementById('altroNome').value;
  const prezzo = parseFloat(document.getElementById('altroPrezzo').value);
  if (!nome || isNaN(prezzo)) return alert('Inserisci un nome e un prezzo validi');
  aggiungiProdotto(nome, prezzo);
  document.getElementById('altroNome').value = '';
  document.getElementById('altroPrezzo').value = '';
}

function rimuoviProdotto(tav, prod) {
  if (tavoli[tav].ordine[prod]) {
    tavoli[tav].ordine[prod].q--;
    if (tavoli[tav].ordine[prod].q <= 0) delete tavoli[tav].ordine[prod];
  }
  renderTavoli();
}

function eliminaTavolo(tav) {
  if (confirm(`Eliminare definitivamente il tavolo ${tav}?`)) {
    delete tavoli[tav];
    if (tavoloSelezionato === tav) tavoloSelezionato = null;
    renderTavoli();
  }
}

// ---------- Render Tavoli ----------
function renderTavoli() {
  const container = document.getElementById('tavoliContainer');
  container.innerHTML = '<h3>Lista Tavoli</h3>';

  for (let t in tavoli) {
    if (statoTavoli[t] === undefined) statoTavoli[t] = false;

    let box = document.createElement('div');
    box.className = 'tavolo-box';
    box.style.marginBottom = '10px';
    box.style.padding = '5px';
    box.style.border = statoTavoli[t] ? '2px solid #3498db' : '1px solid #ccc';
    box.style.backgroundColor = statoTavoli[t] ? '#eaf3ff' : '#f0f0f0';
    box.style.position = 'relative';

    let header = document.createElement('div');
    header.innerHTML = `<strong>Tavolo ${t}</strong>`;
    header.style.cursor = 'pointer';
    header.onclick = () => {
      statoTavoli[t] = !statoTavoli[t];
      lista.style.display = statoTavoli[t] ? 'block' : 'none';
      box.style.border = statoTavoli[t] ? '2px solid #3498db' : '1px solid #ccc';
      box.style.backgroundColor = statoTavoli[t] ? '#eaf3ff' : '#f0f0f0';
    };
    box.appendChild(header);

    let lista = document.createElement('ul');
    lista.style.display = statoTavoli[t] ? 'block' : 'none';
    for (let prod in tavoli[t].ordine) {
      let o = tavoli[t].ordine[prod];
      let li = document.createElement('li');
      li.innerHTML = `${prod} x${o.q} â‚¬${(o.p*o.q).toFixed(2)} 
                      <button onclick="rimuoviProdotto('${t}','${prod}')">-</button>`;
      lista.appendChild(li);
    }
    box.appendChild(lista);

    // Pulsante elimina tavolo piccolo a destra
    let btnDel = document.createElement('button');
    btnDel.textContent = 'ðŸ—‘ï¸';
    btnDel.style.position = 'absolute';
    btnDel.style.right = '5px';
    btnDel.style.top = '5px';
    btnDel.style.width = '30px';
    btnDel.style.height = '30px';
    btnDel.onclick = (e) => {
      e.stopPropagation();
      eliminaTavolo(t);
    };
    box.appendChild(btnDel);

    container.appendChild(box);
  }
}

// ---------- Chiusura Giornaliera ----------
function chiusuraGiornaliera() {
  if (Object.keys(tavoli).length === 0) return alert('Nessun tavolo da esportare');
  let data = new Date();
  let filename = 'riepilogo_'+data.getFullYear()+'-'+(data.getMonth()+1)+'-'+data.getDate()+'.txt';
  let contenuto = 'Riepilogo giornaliero ' + data.toLocaleDateString() + '\n\n';
  for (let t in tavoli) {
    contenuto += `Tavolo ${t}:\n`;
    for (let p in tavoli[t].ordine) {
      let o = tavoli[t].ordine[p];
      contenuto += `  ${p} x${o.q} â‚¬${(o.p*o.q).toFixed(2)}\n`;
    }
    contenuto += '\n';
  }

  // Creazione file
  let blob = new Blob([contenuto], {type:'text/plain'});
  let link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();

  // Faccine e fuochi ðŸŽ†
  alert('Chiusura giornaliera completata! ðŸŽ†');
}

// ---------- Eliminazione tutti i tavoli ----------
function eliminaTuttiTavoli() {
  if (!confirm('Sicuro di voler eliminare tutti i tavoli?')) return;
  if (!confirm('MA SEI PROPRIO SICURO? NON SI TORNA INDIETRO ðŸ˜¢')) return;
  tavoli = {};
  tavoloSelezionato = null;
  renderTavoli();
}
</script>

</body>
</html>
